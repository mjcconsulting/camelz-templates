AWSTemplateFormatVersion: 2010-09-09
Description: Layers Template.
  This creates Lambda Layers intended for use by Functions in multiple areas.
Metadata:
  AWS::CloudFormation::Interface:
    ParameterGroups:
      - Label:
          default: Stack Dependencies
        Parameters:
          - BucketsStackName
      - Label:
          default: Layer Configuration
        Parameters:
          - AsyncCustomResourceLayeS3Key
    ParameterLabels:
      BucketsStackName:
        default: Buckets Stack Name
      AsyncCustomResourceLayerS3Key:
        default: AsyncCustomResource Layer S3 Key
Parameters:
  BucketsStackName:
    Description: Name of the CloudFormation Stack containing Buckets
    Type: String
    MinLength: 2
    MaxLength: 64
    Default: Buckets
    AllowedPattern: ^[A-Z][-a-zA-Z0-9]*$
    ConstraintDescription: must begin with an upper case letter and contain alphanumeric characters and dashes.
  AsyncCustomResourceLayerS3Key:
    Description: Key of Object within the S3 Bucket containing the AsyncCustomResource Lambda Layer zipfile
    Type: String
    MinLength: 2
    MaxLength: 64
    Default: AsyncCustomResourceLayer.zip
    AllowedPattern: ^AsyncCustomResourceLayer(/[0-9a-f]{32})?\.zip$
    ConstraintDescription: must be AsyncCustomResourceLayer.zip, or AsyncCustomResourceLayer/<md5_hash>.zip.
Resources:
  AsyncCustomResourceLayerVersion:
    Type: AWS::Lambda::LayerVersion
    Properties:
      LayerName: AsyncCustomResource
      Description: A Lambda layer version which contains the cfn-response-promise module, needed to write Lambda Functions
        which use the async/await coding style instead of callbacks.
      LicenseInfo: MIT
      CompatibleRuntimes:
        - nodejs8.10
        - nodejs10.x
        - nodejs12.x
      Content:
        S3Bucket: !ImportValue
          Fn::Sub: ${BucketsStackName}-FunctionsBucket
        S3Key: !Ref AsyncCustomResourceLayerS3Key
Outputs:
  AsyncCustomResourceLayerVersionArn:
    Description: The AsyncCustomResource Lambda LayerVersion ARN
    Value: !Ref AsyncCustomResourceLayerVersion
    Export:
      Name: !Sub ${AWS::StackName}-AsyncCustomResourceLayerVersionArn
